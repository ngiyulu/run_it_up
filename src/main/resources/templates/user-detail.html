<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>User • RunItUp Admin</title>
    <link th:href="@{/styles.css}" rel="stylesheet" />
    <style>
        .tabs { display:flex; gap:12px; border-bottom:1px solid #1f2937; margin-bottom:12px; }
        .tab { padding:8px 12px; border:1px solid #1f2937; border-bottom:none; border-radius:10px 10px 0 0; cursor:pointer; }
        .tab.active { background:#0b1220; font-weight:600; }
        .tabpanel { display:none; }
        .tabpanel.active { display:block; }
        .hidden { display:none !important; }
        .muted { color:#9ca3af; }
        .link { text-decoration: underline; }

        .user-card { display:flex; gap:16px; align-items:flex-start; }
        .user-avatar {
            width:120px; height:120px; border-radius:12px; object-fit:cover;
            border:1px solid #1f2937; background:#0f172a;
        }
        .kv { display:grid; grid-template-columns: 160px 1fr; gap:6px 12px; }
        .kv .k { color:#9ca3af; }
        .row-inline { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
        .badge.success { background:#065f46; border-color:#065f46; }
        .list { display:flex; flex-direction:column; gap:8px; }
        .rowline { display:flex; gap:12px; align-items:center; padding:10px; border:1px solid #1f2937; border-radius:10px; }
        .rowline:hover { background: rgba(255,255,255,0.03); }
        .grow { flex:1 1 auto; min-width:0; }
        .nowrap { white-space:nowrap; }
        .toolbar-inline { display:flex; align-items:end; gap:10px; flex-wrap:wrap; margin-bottom:10px; }
        .help { color:#9ca3af; font-size:12px; }
    </style>
</head>
<body>
<header>
    <div class="wrap">
        <div class="brand">RunItUp • Admin</div>
        <nav class="nav">
            <a th:href="@{/admin/dashboard}">Dashboard</a>
            <a th:href="@{/admin/runs}">Run Sessions</a>
            <a th:href="@{/admin/gyms}">Gyms</a>
            <a th:href="@{/admin/users}">Users</a>
            <a href="#" id="logoutBtn">Logout</a>
        </nav>
    </div>
</header>

<div class="container">
    <div class="toolbar">
        <h2 id="title">User</h2>
    </div>

    <div class="tabs">
        <div class="tab active" data-tab="details">Details</div>
        <div class="tab" data-tab="sessions">Run Sessions</div>
    </div>

    <div id="status" class="alert hidden"></div>

    <!-- DETAILS TAB -->
    <div class="tabpanel active" data-panel="details">
        <div class="card user-card" id="userCard">
            <img id="avatar" class="user-avatar" alt="User" />
            <div style="flex:1 1 auto; min-width:0;">
                <div class="row-inline">
                    <h3 id="fullName" style="margin:0;">—</h3>
                    <span id="levelBadge" class="badge hidden"></span>
                    <span id="enabledBadge" class="badge hidden"></span>
                </div>

                <div class="kv" style="margin-top:12px;">
                    <div class="k">User ID</div><div id="uid">—</div>
                    <div class="k">Email</div><div id="email">—</div>

                    <div class="k">Phone</div>
                    <div class="row-inline">
                        <span id="phone">—</span>
                        <span id="phoneVerified" class="badge success hidden">Verified</span>
                    </div>

                    <div class="k">Date of Birth</div><div id="dob">—</div>
                    <div class="k">Skill</div><div id="skill">—</div>
                    <div class="k">Credit</div><div id="credit">—</div>
                    <div class="k">Joined</div><div id="joined">—</div>

                    <!-- Waiver block -->
                    <div class="k">Waiver</div>
                    <div id="waiverBlock">
                        <div id="waiverLinkRow" class="row-inline hidden">
                            <a id="waiverLink" class="link" href="#" target="_blank" rel="noopener">View waiver</a>
                        </div>
                        <div id="waiverSignedRow" class="hidden">
                            <span class="muted">Signed:</span> <span id="waiverSignedAt">—</span>
                        </div>
                        <div id="waiverNotesRow" class="hidden">
                            <span class="muted">Notes:</span> <span id="waiverNotes">—</span>
                        </div>
                        <div id="waiverEmpty" class="muted">No waiver on file.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SESSIONS TAB -->
    <div class="tabpanel" data-panel="sessions">
        <div class="card">
            <div class="toolbar-inline">
                <div>
                    <label for="startDate">Start date *</label>
                    <input id="startDate" type="date" required />
                </div>
                <div>
                    <label for="endDate">End date (optional)</label>
                    <input id="endDate" type="date" />
                </div>
                <div>
                    <button id="searchBtn" class="primary">Search</button>
                </div>
                <div class="grow"></div>
                <div id="countBadge" class="badge">0 sessions</div>
            </div>
            <div class="help">Shows only sessions this user participated in.</div>

            <div id="sessionsList" class="list" style="margin-top:10px;">
                <div class="muted" style="text-align:center;">Pick a date range and click Search.</div>
            </div>
        </div>
    </div>
</div>

<footer><div>© RunItUp Admin</div></footer>

<!-- Global helpers -->
<script th:src="@{/app.js}"></script>
<!-- Page logic -->
<script th:src="@{/user-view.js}"></script>
</body>
</html>
