<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Run Session • RunItUp Admin</title>
    <link th:href="@{/styles.css}" rel="stylesheet" />
    <style>
        .tabs { display:flex; gap:12px; border-bottom:1px solid #1f2937; margin-bottom:12px; }
        .tab { padding:8px 12px; border:1px solid #1f2937; border-bottom:none; border-radius:10px 10px 0 0; cursor:pointer; }
        .tab.active { background:#0b1220; font-weight:600; }
        .tabpanel { display:none; }
        .tabpanel.active { display:block; }
        .muted { opacity:0.5; pointer-events:none; }
        .hidden { display:none !important; }
        .danger { background:#7f1d1d; border-color:#7f1d1d; }

        .checkline { display:inline-flex; align-items:center; gap:8px; font-weight:500; }
        .checkline input[type="checkbox"] { width:18px; height:18px; }

        /* Gym section */
        .gym-section { border:1px solid #1f2937; border-radius:12px; padding:12px; background:#0b1220; }
        .gym-section .section-head { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
        .gym-empty { color:#9ca3af; padding:10px; border:1px dashed #374151; border-radius:10px; }
        .gym-picked { display:flex; align-items:center; gap:12px; }
        .gym-picked-thumb { width:80px; height:80px; border-radius:10px; object-fit:cover; border:1px solid #1f2937; }

        /* Modal */
        .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:9999; }
        .modal { background:#0b1220; border:1px solid #1f2937; border-radius:14px; padding:16px; width:min(900px,95vw); max-height:85vh; overflow:auto; }
        .modal .toolbar { display:flex; align-items:center; gap:8px; margin:0 0 10px 0; }
        .grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
        .gym-card { display:flex; align-items:center; gap:12px; border:1px solid #1f2937; border-radius:12px; padding:10px; }
        .gym-thumb { width:72px; height:72px; object-fit:cover; border-radius:10px; border:1px solid #1f2937; }
    </style>
</head>
<body>
<header>
    <div class="wrap">
        <div class="brand">RunItUp • Admin</div>
        <nav class="nav">
            <a th:href="@{/admin/dashboard}">Dashboard</a>
            <a th:href="@{/admin/runs}">Run Sessions</a>
            <a th:href="@{/admin/gyms}">Gyms</a>
            <a href="#" id="logoutBtn">Logout</a>
        </nav>
    </div>
</header>

<div class="container">
    <div class="toolbar">
        <h2 id="pageTitle">Create Run Session</h2>
    </div>

    <div id="status" class="alert hidden"></div>

    <!-- Tabs -->
    <div class="tabs">
        <div class="tab active" data-tab="details">Details</div>
        <div class="tab" data-tab="players">Players</div>
        <div class="tab" data-tab="waitlist">Waitlist</div>
    </div>

    <!-- Details Tab -->
    <form id="runForm" class="card tabpanel active" data-panel="details" style="max-width:1000px;">
        <div class="row">
            <div class="col">
                <label for="title">Title *</label>
                <input id="title" placeholder="Morning Run at Downtown Gym" required />
            </div>
            <div class="col">
                <label for="date">Date *</label>
                <input id="date" type="date" required />
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label for="startTime">Start Time *</label>
                <input id="startTime" type="time" required />
            </div>
            <div class="col">
                <label for="endTime">End Time *</label>
                <input id="endTime" type="time" required />
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label for="amount">Amount per player *</label>
                <input id="amount" type="number" step="0.01" min="0" placeholder="15.00" required />
            </div>
            <div class="col">
                <label for="maxPlayer">Max Players *</label>
                <input id="maxPlayer" type="number" min="10" placeholder="20" required />
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label class="checkline" for="allowGuest">
                    <input id="allowGuest" type="checkbox" />
                    <span>Allow Guests</span>
                </label>
            </div>
            <div class="col">
                <label for="maxGuest">Max Guests</label>
                <input id="maxGuest" type="number" min="0" placeholder="0" />
                <small id="guestHelp">Disabled when "Allow Guests" is off.</small>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label class="checkline" for="privateRun">
                    <input id="privateRun" type="checkbox" />
                    <span>Private Run (Unlisted)</span>
                </label>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label for="notes">Notes</label>
                <textarea id="notes" rows="3" placeholder="Internal notes..."></textarea>
            </div>
            <div class="col">
                <label for="description">Description</label>
                <textarea id="description" rows="3" placeholder="Public description shown to players..."></textarea>
            </div>
        </div>

        <!-- Gym -->
        <div class="row">
            <div class="col" style="width:100%;">
                <div class="gym-section">
                    <div class="section-head">
                        <div class="label">Gym *</div>
                        <button type="button" class="primary" id="chooseGymBtn">Choose Gym</button>
                    </div>
                    <div id="gymEmptyState" class="gym-empty">No gym selected</div>
                    <div id="gymPickedState" class="gym-picked hidden">
                        <img id="gymThumb" class="gym-picked-thumb" alt="Gym image" />
                        <div>
                            <div id="gymTitleText" class="title">—</div>
                            <div id="gymAddrText" class="addr">—</div>
                        </div>
                    </div>
                    <input type="hidden" id="gymId" />
                </div>
            </div>
        </div>

        <!-- Time zone -->
        <div class="row" style="margin-top:12px;">
            <div class="col">
                <label for="zoneId">Time Zone *</label>
                <select id="zoneId" required>
                    <option value="" disabled selected>Select time zone…</option>
                    <option value="America/New_York">America/New_York (ET)</option>
                    <option value="America/Chicago">America/Chicago (CT)</option>
                    <option value="America/Denver">America/Denver (MT)</option>
                    <option value="America/Phoenix">America/Phoenix (No DST)</option>
                    <option value="America/Los_Angeles">America/Los_Angeles (PT)</option>
                    <option value="America/Anchorage">America/Anchorage</option>
                    <option value="Pacific/Honolulu">Pacific/Honolulu</option>
                    <option disabled>──────────</option>
                    <option value="UTC">UTC</option>
                </select>
            </div>
        </div>

        <div class="row" style="align-items:flex-start;">
            <div class="col" style="display:flex; gap:10px; align-items:center;">
                <button class="primary" id="saveBtn" type="submit">Save</button>
                <button id="resetBtn" type="button">Reset</button>
                <button id="cancelBtn" type="button" class="danger">Cancel</button>
            </div>
        </div>
    </form>

    <!-- Players -->
    <div class="card tabpanel" data-panel="players">
        <div class="toolbar"><h3>Players</h3></div>
        <div id="playersList" class="list"><div style="text-align:center;color:gray;">No players.</div></div>
    </div>

    <!-- Waitlist -->
    <div class="card tabpanel" data-panel="waitlist">
        <div class="toolbar"><h3>Waitlist</h3></div>
        <div id="waitList" class="list"><div style="text-align:center;color:gray;">No players.</div></div>
    </div>
</div>

<footer><div>© RunItUp Admin</div></footer>

<!-- Gym Picker Modal -->
<div id="gymModal" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-label="Choose Gym">
        <div class="toolbar">
            <h3 style="margin:0;">Choose Gym</h3>
            <input id="gymSearch" type="search" placeholder="Search gyms…" style="margin-left:auto;" />
            <button id="gymCloseBtn" type="button">Close</button>
        </div>
        <div id="gymList" class="grid"></div>
        <div id="gymEmpty" class="alert hidden" style="margin-top:10px;">No gyms found.</div>
    </div>
</div>

<script th:src="@{/app.js}"></script>
<script th:src="@{/run-session-form.js}"></script>
</body>
</html>
